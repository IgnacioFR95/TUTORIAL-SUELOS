---
title: "**TUTORIAL CARTOGRAFÍA EDÁFICA**"
author: "Ignacio Fernández  Ruiz"
date: "23/5/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##### **¡ANTENCIÓN!**
##### **LEA ANTENTAMENTE EL ARCHIVO "README" ANTES DE INICIAR ESTE TUTORIAL.**

Para cualquier información adicional sobre el funcionamiento de algún comando, puede utilizar ***"?NombreDelComando"***. Lo que abrirá una nueva pestaña con más información sobre su uso y la gramática que utiliza. Si el comando pertenece a un paquete de R concreto, puede utilizar el comando ***"??NombreDelComando"*** para recibir la misma información.

___________________________________________________________________________________________
Á É Í Ó Ú á é í ó ú    Ñ ñ

## **ÍNDICE**
    
###  [1.PREPARACIÓN DE LOS DATOS](#id1)
#### [1.1 Carga de datos iniciales](#id11)
#### [1.2 Comprobaciones iniciales](#id11)
###### [1.2.a Verificación de la versión de R](#id12a)
###### [1.2.b Verificación de la versión de RStudio](#id12b)
###### [1.2.c Verificación de los paquetes CRAN](#id12c)
###### [1.2.d Finalización de las comprobaciones](#id12d)
###### [1.2.e Curating data](#id12e)
   
### [2. PREPARACIÓN DEL ÁREA DE ESTUDIO](#id2)
#### [2.1 Generación del mapa base](#id21)
######  [2.1.a Generación del polígono](#id21a)
###### [2.1.b Generación de la malla](#id21b)
#### [2.2 Adaptación de los datos al mapa base](#id22)
   
### [3. NORMALIZACIÓN DE LAS VARIABLES](#id3)
#### [3.1 Metodología de normalización de variables](#id31)
###### [3.1.a Histograma](#id31a)
###### [3.1.b Gráfico cuantil-cuantil](#id31b)
###### [3.1.c Test de shapiro](#id31c)
###### [3.1.d Modificación de los datos](#id31d)
#### [3.2 Normalización variable GLUCOSIDASA](#id32)
#### [3.3 Normalización variable FOSFATASA](#id33)
#### [3.4 Normalización variable NITRÓGENO](#id34)
#### [3.5 Normalización variable FÓSFORO](#id35)
#### [3.6 Normalización variable POTASIO](#id36)
#### [3.7 Normalización variable CARBONO](#id37)
#### [3.8 Normalización variable pH](#id38)
#### [3.9 Normalización variable ARENA](#id39)
#### [3.10 Normalización variable LIMO](#id310)
#### [3.11 Normalización variable ARCILLA](#id311)
   
### [4. GENERACIÓN DE LA CARTOGRAFÍA EDÁFICA](#id4)
#### [4.1 Metodología de cartografía edáfica](#id41)
###### [4.1.a Función "autokriging()"](#id41a)
###### [4.1.b Kriging manual](#id41b)
#### [4.2 Cartografía de variable GLUCOSIDASA](#id42)
###### [4.2.a Autokriging de Glucosidasa](#id42a)
###### [4.2.b Kriging manual de Glucosidasa](#id42b)
#### [4.3 Cartografía de variable FOSFATASA](#id43)
###### [4.3.a Autokriging de Fosfatasa](#id43a)
###### [4.3.b Kriging manual de Fosfatasa](#id43b)
#### [4.4 Cartografía de variable NITRÓGENO](#id44)
###### [4.4.a Autokriging de Nitrógeno](#id44a)
###### [4.4.b Kriging manual de Nitrógeno](#id44b)
#### [4.5 Cartografía de variable FÓSFORO](#id45)
###### [4.5.a Autokriging de Fósforo](#id45a)
###### [4.5.b Kriging manual de Fósforo](#id45b)
#### [4.6 Cartografía de variable POTASIO](#id46)
######  [4.6.aAutokriging de Potasio](#id46a)
######  [4.6.b Kriging manual de Potasio](#id46b)
#### [4.7 Cartografía de variable CARBONO](#id47)
###### [4.7.a Autokriging de Carbono](#id47a)
###### [4.7.b Kriging manual de Carbono](#id47b)
#### [C4.8 artografía de variable pH](#id48)
###### [4.8.a Autokriging de pH](#id48a)
###### [4.8.b Kriging manual de pH](#id48b)
#### [4.9 Cartografía de variable ARENA](#id49)
###### [4.9.a Autokriging de Arena](#id49a)
###### [4.9.b Kriging manual de Arena](#id49b)
#### [4.10 Cartografía de variable LIMO](#id410)
###### [4.10.a Autokriging de Limo](#id410a)
###### [4.10.b Kriging manual de Limo](#id410b)
#### [4.11 Cartografía de variable ARCILLA](#id411)
###### [4.11.a Autokriging de Arcilla](#id411a)
###### [4.11.b Kriging manual de Arcilla](#id411b)

___

## |1| PREPARACIÓN DE LOS DATOS<a name="id1"></a>
En esta fase, realizaremos todas las operaciones previas a la generación de la cartografía. Comprobaremos las versiones utilizadas, descargaremos los datos y paquetes necesarios para las fases posteriores y transformaremos los datos a  los formatos espaciales necesarios.


### |1.1| Carga de datos iniciales<a name="id11"></a>
Antes de realizar ninguna operación, debemos decirle al proyecto de R con qué datos vamos a trabajar. En nuestro caso, hemos generado en formato ***".txt"*** los datos a partir de un archivo de excel ***".xlsx"***. De esta forma podremos trabajar con ellos en forma de código (Eliminando la necesidad de programas externos).

El comando que utilizaremos será ***"read.delim"***, este comando lee un archivo y crea un nuevo objeto con la información de este archivo como una si fuera una base de datos.

~~~
VariablesSuelo <- read.delim("data/Orusco_suelos.txt", sep="\t", dec=",", header=T)
load("data/AerialRoot.community.corregido.Rdata")
~~~

Este comando dice: *"Crea un nuevo objeto con el archivo de .txt con los datos, su  separación será con barras, el símbolo que marca el decimal es coma* **","** *y  la primera fila de los datos corresponde al enunciado de las variables (por eso le decimos que los datos tienen enunciado, y que lo tenga en cuenta como tal)"*.


### |1.2| Comprobaciones iniciales<a name="id12"></a>

Las siguientes operaciones, cargan algunos parámetros imprescindibles para la realización de este tutorial. A su vez, comprueba que la versión de R es apta para trabajar y confirma la correcta instalación de todos los paquetes que vamos a necesitar. Por último, se realiza un "curating data" de los datos, que es un  proceso en el que se homogeniza la base de datos brutos  y se eliman los parámetros innecesarios para el tutorial. (Los datos contienen información extra que otro investigador podría utilizar en el futuro para sus estudios)

#### |1.2.a| Verificación de la versión de R:<a name="id12a"></a>
Comprobaremos que la versión sea igual o superior a la 3.6.0.

~~~
if(getRversion() < "3.6.0") {stop("##########\nLa versión de R que posee es antigua\nPor favor, instale la última versión\n##########")}
~~~

El comando aplica lo siguiente: *"Si la versión de R es menor que la* ***3.6.0*** *, genera un mensaje de alerta donde especifique el mensaje"* (En este caso, el mensaje elegido es un aviso de que la versión de R es antigua y se necesita actualizar).

#### |1.2.b| Verificación de la versión de RStudio::<a name="id12b"></a>
Comprobaremos que la versión sea igual o superior a la 1.0.1.

~~~
if(RStudio.Version()$version < "1.0.1"){stop("##########\nLa versión de RStudio que posee es antigua\nPor favor, instale la última versión\n##########")}
~~~

El comando aplica lo siguiente: *"Si la versión de RStudio es menor que la* ***3.6.0*** *, genera un mensaje de alerta donde especifique el mensaje"* (En este caso, el mensaje elegido es un aviso de que la versión de RStudio es antigua y se necesita actualizar).

#### |1.2.c| Verificación de los paquetes CRAN:<a name="id12c"></a>
Comprobaremos si los paquetes necesarios están instalados.

~~~
PaquetesNecesarios <- c("lattice","sp","gstat","maptools","spatstat","raster","automap")
installed_packages <- .packages(all.available = TRUE)
PaquetesNecesarios2 <- PaquetesNecesarios[!PaquetesNecesarios %in% installed_packages]
~~~

Descarga de paquetes faltantes de CRAN: 

~~~
if(length(PaquetesNecesarios2) > 0){install.packages(PaquetesNecesarios2)}
stopifnot(all(c(PaquetesNecesarios) %in% .packages(all.available = TRUE)))
~~~

#### |1.2.d| Finalización de las comprobaciones:<a name="id12d"></a>

~~~
rm(PaquetesNecesarios, PaquetesNecesarios2, installed_packages)
~~~

El comando ***"rm()"*** elimina los objetos puestos entre paréntesis, en este caso los objetos que hemos utilizado para confirmar que los paquetes están instalados.

#### |1.2.e| Curating data:<a name="id12e"></a>

Renombramos el título de de la columna 11 (COD -> Codigo_muestra):

~~~
colnames(VariablesSuelo)[11] <- "Codigo_muestra"
~~~

Eliminamos las columnas que no nos interesan para este tutorial en concreto, simplificando así los datos:

~~~
orusco.soil <- VariablesSuelo
VariablesSuelo$Fecha <- NULL
VariablesSuelo$COND <- NULL
VariablesSuelo$Altura.elipsoidal <- NULL
VariablesSuelo$id_suelo_raiz <- NULL
VariablesSuelo$Nº <- NULL
VariablesSuelo$Marco <- NULL
VariablesSuelo$ID_GPS <- NULL
~~~


## |2| PREPARACIÓN DEL ÁREA DE ESTUDIO<a name="id2"></a>
En este proceso, vamos a generar el mapa base desde el cual vamos a realizar posteriormente el mapa de cada variable. En esta fase indicaremos el tamaño  del área de estudio, las coordenadas que poseen y el tamaño de malla que  utilizaremos para el posterior análisis por kriging.También refinaremos y adaptaremos los datos al tamaño y forma del área estudiada.

## |3| NORMALIZACIÓN DE LAS VARIABLES <a name="id3"></a>
En esta tercera fase, vamos a transformar los datos brutos para conseguir que sigan una tendencia normalizada. Esto nos permitirá realizar la cartografía de cada variable utilizando el mÃ©todo de kriging y autokriging en la fase 4.

## |4| GENERACIÓN CARTOGRAFÍA EDÁFICA <a name="id4"></a>
En esta última fase, vamos a realizar los mapas de cada una de las variables utilizando el mÃ©todo de estimación geoestadístico denominado kriging.Esta  tÃ©cnica de interpolación, utiliza un modelo de variograma para poder estimar  el resto de puntos intermedios donde no se tiene un dato real recogido directamente del campo.

### |1.1| Carga de datos iniciales<a name="id11"></a>
Antes de realizar ninguna operación, debemos decirle al proyecto de R con qué datos vamos a trabajar. En nuestro caso, hemos generado en formato ".txt" los datos a partir de un archivo de excel ".xlsx". De esta forma podremos trabajar con ellos en forma de código (Eliminando la necesidad de programas externos).

El comando que utilizaremos será "read.delim", este comando lee un archivo y  crea un nuevo objeto con la información de este archivo como una si fuera una base de datos.







































## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
